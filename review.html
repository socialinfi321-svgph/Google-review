<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Review Partner - Display</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    ::-webkit-scrollbar {
      width: 0px;
      background: transparent;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/framer-motion@10/dist/framer-motion.js"></script>
  
  <script>
    const { useState, useEffect, useCallback, createElement: h } = React;
    const { createRoot } = ReactDOM;

    const STORAGE_KEYS = {
      QRS: 'review_partner_qrs',
      SETTINGS: 'review_partner_settings',
      STATS: 'review_partner_stats',
    };

    const DEFAULT_SETTINGS = {
      intervalSeconds: 10,
    };

    const DEFAULT_STATS = {
      totalContributions: 0,
    };

    const getQRCodes = () => {
      try {
        const data = localStorage.getItem(STORAGE_KEYS.QRS);
        return data ? JSON.parse(data) : [];
      } catch (e) {
        console.error("Failed to load QRs", e);
        return [];
      }
    };

    const getSettings = () => {
      try {
        const data = localStorage.getItem(STORAGE_KEYS.SETTINGS);
        return data ? JSON.parse(data) : DEFAULT_SETTINGS;
      } catch (e) {
        return DEFAULT_SETTINGS;
      }
    };

    const getStats = () => {
      try {
        const data = localStorage.getItem(STORAGE_KEYS.STATS);
        return data ? JSON.parse(data) : DEFAULT_STATS;
      } catch (e) {
        return DEFAULT_STATS;
      }
    };

    const incrementStats = () => {
      const stats = getStats();
      const newStats = { ...stats, totalContributions: stats.totalContributions + 1 };
      localStorage.setItem(STORAGE_KEYS.STATS, JSON.stringify(newStats));
      window.dispatchEvent(new Event('storage'));
      return newStats;
    };

    // Plus Icon Component
    const PlusIcon = () => h('svg', {
      xmlns: "http://www.w3.org/2000/svg",
      width: 24,
      height: 24,
      viewBox: "0 0 24 24",
      fill: "none",
      stroke: "currentColor",
      strokeWidth: 2,
      strokeLinecap: "round",
      strokeLinejoin: "round",
      className: "w-6 h-6"
    },
      h('path', { d: "M5 12h14" }),
      h('path', { d: "M12 5v14" })
    );

    const DisplayPage = () => {
      const [qrs, setQrs] = useState([]);
      const [currentIndex, setCurrentIndex] = useState(0);
      const [intervalSec, setIntervalSec] = useState(10);
      const [contributions, setContributions] = useState(0);

      useEffect(() => {
        const loadData = () => {
          setQrs(getQRCodes());
          setIntervalSec(getSettings().intervalSeconds);
          setContributions(getStats().totalContributions);
        };

        loadData();

        const handleStorageChange = () => loadData();
        window.addEventListener('storage', handleStorageChange);
        return () => window.removeEventListener('storage', handleStorageChange);
      }, []);

      useEffect(() => {
        if (qrs.length <= 1) return;

        const timer = setInterval(() => {
          setCurrentIndex((prev) => (prev + 1) % qrs.length);
        }, intervalSec * 1000);

        return () => clearInterval(timer);
      }, [qrs.length, intervalSec]);

      const handleContribution = useCallback(() => {
        const newStats = incrementStats();
        setContributions(newStats.totalContributions);
      }, []);

      const currentQR = qrs[currentIndex];

      return h('div', { className: "min-h-screen bg-white flex flex-col items-center justify-center relative overflow-hidden" },
        h('div', { className: "absolute top-12 w-full text-center px-4" },
          h('h1', { className: "text-4xl md:text-6xl font-extrabold tracking-tight" },
            h('span', { className: "bg-clip-text text-transparent bg-gradient-to-r from-blue-600 via-red-500 to-yellow-500" },
              "Contribute Google Reviews"
            )
          ),
          h('p', { className: "mt-2 text-gray-400 uppercase tracking-widest text-xs font-semibold" },
            "Review Partner System"
          )
        ),
        h('div', { className: "flex flex-col items-center z-10 w-full max-w-md px-6" },
          h('div', { 
            key: currentQR ? currentQR.id : 'empty',
            className: "relative w-72 h-72 md:w-96 md:h-96 bg-gray-50 rounded-3xl shadow-2xl flex items-center justify-center border border-gray-100 p-6" 
          },
            currentQR ? 
              h('img', {
                src: currentQR.base64,
                alt: "QR Code",
                className: "w-full h-full object-contain"
              }) :
              h('div', {
                className: "text-gray-300 font-medium text-center"
              }, "No active QR Codes")
          ),
          h('button', {
            onClick: handleContribution,
            className: "mt-12 group flex items-center gap-2 bg-black text-white px-8 py-4 rounded-full font-bold text-lg hover:scale-105 active:scale-95 transition-all shadow-lg hover:shadow-xl"
          },
            h(PlusIcon),
            h('span', null, "Contribute")
          )
        ),
        h('div', { className: "fixed bottom-8 right-8 bg-gray-900 text-white px-6 py-3 rounded-2xl shadow-xl backdrop-blur-md bg-opacity-90 border border-gray-800" },
          h('div', { className: "text-xs text-gray-400 uppercase font-bold tracking-wider mb-1" },
            "Total Contributions"
          ),
          h('div', { className: "text-3xl font-mono font-bold text-green-400" },
            contributions.toLocaleString()
          )
        )
      );
    };

    const root = createRoot(document.getElementById('root'));
    root.render(h(DisplayPage));
  </script>
</body>
</html>