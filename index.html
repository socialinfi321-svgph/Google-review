<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Review Partner</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Tailwind Configuration -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          animation: {
            'blob': 'blob 7s infinite',
            'fade-in': 'fadeIn 0.5s ease-out forwards',
          },
          keyframes: {
            blob: {
              '0%': { transform: 'translate(0px, 0px) scale(1)' },
              '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
              '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
              '100%': { transform: 'translate(0px, 0px) scale(1)' },
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            }
          }
        }
      }
    }
  </script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      overflow: hidden; /* Global lock */
      height: 100vh;
      height: 100dvh;
    }
    
    #app {
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    /* Transitions for dark mode */
    .transition-colors-custom {
      transition: background-color 0.5s ease, color 0.5s ease;
    }

    /* Hotstar-style Carousel Logic */
    .carousel-track {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    
    .carousel-slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 1rem;
      transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
      will-change: transform;
    }
    
    /* States for animation */
    .slide-current { transform: translateX(0); z-index: 10; }
    .slide-next { transform: translateX(100%); z-index: 20; }
    .slide-prev { transform: translateX(-100%); z-index: 0; }

    /* Custom Scrollbar */
    .custom-scroll::-webkit-scrollbar {
      width: 4px;
    }
    .custom-scroll::-webkit-scrollbar-track {
      background: transparent;
    }
    .custom-scroll::-webkit-scrollbar-thumb {
      background-color: rgba(156, 163, 175, 0.5);
      border-radius: 20px;
    }
    
    /* Hide scrollbar utility */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "lucide-react": "https://esm.sh/lucide-react@^0.561.0",
    "framer-motion": "https://esm.sh/framer-motion@^12.23.26",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.10.1"
  }
}
</script>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-zinc-950 dark:text-gray-100 transition-colors-custom">
  
  <div id="app"></div>

  <!-- Firebase Modular SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, set, runTransaction } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // ==========================================
    // CONFIGURATION
    // ==========================================
    const FIREBASE_CONFIG = {
      apiKey: "AIzaSyCEhEQ0s_3CP6FcyL5Cwpc6nV6wRhxQJ9U",
      authDomain: "qr-scanner-e0f27.firebaseapp.com",
      databaseURL: "https://qr-scanner-e0f27-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "qr-scanner-e0f27",
      storageBucket: "qr-scanner-e0f27.firebasestorage.app",
      messagingSenderId: "600985068770",
      appId: "1:600985068770:web:db5c50979b22b81ab56abb"
    };

    const ADMIN_PASS = "12345676";
    const DEFAULT_SETTINGS = { intervalSeconds: 10 };
    const DEFAULT_STATS = { totalContributions: 0, lastResetTime: Date.now() };

    // ==========================================
    // STATE
    // ==========================================
    let state = {
      qrs: [],
      settings: DEFAULT_SETTINGS,
      stats: DEFAULT_STATS,
      isAuthenticated: false,
      currentQRIndex: 0,
      rotationIntervalId: null,
      passwordInput: "",
      db: null,
      isConnected: false
    };

    // ==========================================
    // FIREBASE SERVICE
    // ==========================================
    const DB = {
      init: () => {
        try {
          const app = initializeApp(FIREBASE_CONFIG);
          state.db = getDatabase(app);
          state.isConnected = true;
          DB.listen();
        } catch (e) {
          console.error("Firebase Init Error", e);
          state.isConnected = false;
        }
      },

      listen: () => {
        if (!state.db) return;

        // QRs Listener
        onValue(ref(state.db, 'qrs'), (snapshot) => {
          state.qrs = snapshot.val() || [];
          if (window.location.hash === '#/admin') render(); 
        });

        // Settings Listener
        onValue(ref(state.db, 'settings'), (snapshot) => {
          state.settings = snapshot.val() || DEFAULT_SETTINGS;
          if (window.location.hash === '#/admin') {
             // Update input value if changed externally
             const input = document.getElementById('input-interval');
             if(input && document.activeElement !== input) input.value = state.settings.intervalSeconds;
          } else {
             startDisplayRotation();
          }
        });

        // Stats Listener
        onValue(ref(state.db, 'stats'), (snapshot) => {
          const data = snapshot.val();
          if (data) {
             const now = Date.now();
             if (now - data.lastResetTime > 86400000) {
                DB.resetStats(); 
             } else {
                state.stats = data;
                updateCounters();
             }
          } else {
              state.stats = DEFAULT_STATS;
          }
        });
      },

      // Write Operations
      addQR: (qr) => {
        if (!state.db) return;
        set(ref(state.db, 'qrs'), [...state.qrs, qr]);
      },
      deleteQR: (id) => {
        if (!state.db) return;
        set(ref(state.db, 'qrs'), state.qrs.filter(q => q.id !== id));
      },
      reorderQRs: (newQRs) => {
        if (!state.db) return;
        set(ref(state.db, 'qrs'), newQRs);
      },
      updateSettings: (newSettings) => {
        if (!state.db) return;
        set(ref(state.db, 'settings'), newSettings);
      },
      incrementStats: () => {
        if (!state.db) return;
        runTransaction(ref(state.db, 'stats'), (current) => {
          if (current) {
            return { ...current, totalContributions: current.totalContributions + 1 };
          }
          return { totalContributions: 1, lastResetTime: Date.now() };
        });
      },
      resetStats: () => {
        if (!state.db) return;
        set(ref(state.db, 'stats'), { totalContributions: 0, lastResetTime: Date.now() });
      }
    };

    // ==========================================
    // GLOBAL EXPORTS (Crucial for HTML onclicks)
    // ==========================================
    window.DB = DB;
    window.state = state;

    // ==========================================
    // UI HELPERS
    // ==========================================
    const Theme = {
      init: () => {
        const t = localStorage.getItem('theme');
        if (t === 'dark' || (!t && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      },
      toggle: () => {
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        render(); 
      }
    };
    window.Theme = Theme; // Export Theme

    function updateCounters() {
      const els = document.querySelectorAll('.stat-counter');
      els.forEach(el => el.textContent = state.stats.totalContributions);
    }

    function createIcon(name, size = 24) {
      return `<i data-lucide="${name}" width="${size}" height="${size}"></i>`;
    }

    // ==========================================
    // ROUTING
    // ==========================================
    function handleRoute() {
      if(state.rotationIntervalId) clearInterval(state.rotationIntervalId);
      
      const hash = window.location.hash.slice(1) || '/';
      const app = document.getElementById('app');

      if (hash === '/admin') {
        renderAdmin(app);
      } else {
        renderDisplay(app);
      }
      lucide.createIcons();
    }

    function render() {
      // Re-render current route content
      handleRoute();
    }
    window.render = render; // Export render

    // ==========================================
    // FRONTEND: DISPLAY PAGE
    // ==========================================
    function renderDisplay(app) {
      app.innerHTML = `
        <!-- Background -->
        <div class="absolute top-0 -left-10 w-96 h-96 bg-purple-300 dark:bg-purple-900/20 rounded-full mix-blend-multiply dark:mix-blend-normal filter blur-3xl opacity-50 animate-blob"></div>
        <div class="absolute top-0 -right-10 w-96 h-96 bg-blue-300 dark:bg-blue-900/20 rounded-full mix-blend-multiply dark:mix-blend-normal filter blur-3xl opacity-50 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-20 left-1/2 w-96 h-96 bg-pink-300 dark:bg-pink-900/20 rounded-full mix-blend-multiply dark:mix-blend-normal filter blur-3xl opacity-50 animate-blob animation-delay-4000"></div>

        <!-- Sidebar -->
        <div id="sidebar-backdrop" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-40 hidden opacity-0 transition-opacity duration-300"></div>
        <div id="sidebar-panel" class="fixed top-0 left-0 h-full w-80 bg-white dark:bg-zinc-900 border-r border-gray-200 dark:border-zinc-800 z-50 shadow-2xl p-6 flex flex-col transform -translate-x-full transition-transform duration-300">
            <div class="flex justify-between items-center mb-8">
              <h2 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-purple-600">Menu</h2>
              <button onclick="toggleSidebar(false)" class="p-2 hover:bg-gray-100 dark:hover:bg-zinc-800 rounded-full text-gray-500">${createIcon('x')}</button>
            </div>
            <div class="bg-gray-50 dark:bg-zinc-800/50 p-5 rounded-2xl border border-gray-100 dark:border-zinc-700 mb-6">
               <h3 class="font-bold text-gray-900 dark:text-white text-sm uppercase tracking-wider mb-2 flex gap-2 items-center text-blue-500">${createIcon('info', 16)} Disclaimer</h3>
               <p class="text-sm text-gray-600 dark:text-gray-300 text-justify">All reviews are voluntary. No incentives are provided.</p>
            </div>
            <div class="mt-auto text-center border-t border-gray-100 dark:border-zinc-800 pt-6">
               <button onclick="window.location.hash='/admin'" class="text-xs font-bold text-gray-400 hover:text-blue-500 uppercase tracking-widest">Admin Access</button>
            </div>
        </div>

        <!-- Controls -->
        <button onclick="toggleSidebar(true)" class="absolute top-6 left-6 z-30 p-3 bg-white/50 dark:bg-zinc-800/50 backdrop-blur-md rounded-full shadow-lg hover:scale-110 transition-transform text-gray-900 dark:text-white">${createIcon('menu')}</button>
        <button onclick="Theme.toggle()" class="absolute top-6 right-6 z-30 p-3 rounded-full bg-white/50 dark:bg-zinc-800/50 backdrop-blur-md shadow-lg hover:scale-110 transition-transform text-gray-600 dark:text-yellow-400">
            ${createIcon(document.documentElement.classList.contains('dark') ? 'sun' : 'moon')}
        </button>

        <!-- Main Content -->
        <div class="flex flex-col items-center justify-center h-full w-full px-6 z-10 relative">
          
          <div class="text-center mb-8 mt-16 animate-fade-in">
             <h1 class="text-4xl md:text-6xl font-black tracking-tighter leading-tight mb-2">
               <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 dark:from-blue-400 dark:via-indigo-400 dark:to-purple-400">Review</span>
               <span class="text-gray-900 dark:text-white"> Partner</span>
             </h1>
             <p class="text-xs md:text-sm font-bold tracking-[0.2em] text-gray-400 uppercase">Contribution System</p>
          </div>

          <!-- QR Carousel -->
          <div class="relative mb-10 animate-fade-in" style="animation-delay: 0.2s">
              <div class="absolute -inset-0.5 bg-gradient-to-tr from-blue-500 to-purple-500 rounded-[2.5rem] opacity-30 blur-lg"></div>
              <div class="relative w-[280px] h-[320px] md:w-[360px] md:h-[400px] bg-white dark:bg-zinc-900 rounded-[2.5rem] shadow-2xl overflow-hidden border border-gray-100 dark:border-zinc-800">
                  <div id="carousel-track" class="carousel-track">
                     <div class="flex h-full items-center justify-center text-gray-400">
                        <div class="text-center">
                            <div class="animate-spin mb-2 mx-auto w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"></div>
                            <span class="text-xs">Connecting...</span>
                        </div>
                     </div>
                  </div>
                  <!-- Bottom Trim -->
                  <div class="absolute bottom-0 left-0 w-full h-6 bg-gradient-to-t from-white dark:from-zinc-900 to-transparent z-30"></div>
              </div>
          </div>

          <button onclick="DB.incrementStats()" class="group relative flex items-center gap-3 bg-gray-900 dark:bg-white text-white dark:text-black px-12 py-4 rounded-2xl font-bold text-lg shadow-xl hover:scale-105 active:scale-95 transition-all animate-fade-in" style="animation-delay: 0.4s">
            <div class="absolute inset-0 rounded-2xl bg-white/20 dark:bg-black/10 blur opacity-0 group-hover:opacity-100 transition-opacity"></div>
            ${createIcon('plus', 20)} <span>Contribute</span>
          </button>
        </div>

        <!-- Counter -->
        <div class="absolute bottom-6 right-6 md:bottom-10 md:right-10 flex flex-col items-end z-20 pointer-events-none select-none animate-fade-in" style="animation-delay: 0.6s">
           <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-0">Total</span>
           <div class="stat-counter text-6xl md:text-7xl font-mono font-black text-gray-900 dark:text-white leading-none tracking-tighter">
             ${state.stats.totalContributions}
           </div>
        </div>
      `;

      startDisplayRotation();
    }

    // ==========================================
    // CAROUSEL LOGIC
    // ==========================================
    function startDisplayRotation() {
      if (state.rotationIntervalId) clearInterval(state.rotationIntervalId);

      const updateSlide = () => {
        const track = document.getElementById('carousel-track');
        if (!track) return;
        
        if (state.qrs.length === 0) {
            track.innerHTML = `<div class="flex h-full items-center justify-center text-center p-6"><p class="text-gray-400">No QR Codes Active</p></div>`;
            return;
        }

        if (state.qrs.length === 1) {
            track.innerHTML = `<img src="${state.qrs[0].base64}" class="w-full h-full object-contain p-4" />`;
            return;
        }

        if (!track.querySelector('.carousel-slide')) {
            track.innerHTML = '';
            const img = document.createElement('img');
            img.src = state.qrs[state.currentQRIndex].base64;
            img.className = 'carousel-slide slide-current object-contain';
            track.appendChild(img);
        }
      };

      updateSlide();

      if (state.qrs.length > 1) {
          state.rotationIntervalId = setInterval(() => {
            const track = document.getElementById('carousel-track');
            if(!track) return;

            const nextIndex = (state.currentQRIndex + 1) % state.qrs.length;
            const nextQR = state.qrs[nextIndex];

            const currentEl = track.querySelector('.slide-current');
            const nextEl = document.createElement('img');
            nextEl.src = nextQR.base64;
            nextEl.className = 'carousel-slide slide-next object-contain';
            track.appendChild(nextEl);

            void nextEl.offsetWidth; // Reflow

            if(currentEl) {
                currentEl.classList.remove('slide-current');
                currentEl.classList.add('slide-prev');
            }
            nextEl.classList.remove('slide-next');
            nextEl.classList.add('slide-current');

            setTimeout(() => {
                if(currentEl) currentEl.remove();
            }, 600); 

            state.currentQRIndex = nextIndex;

          }, state.settings.intervalSeconds * 1000);
      }
    }

    // ==========================================
    // SIDEBAR LOGIC
    // ==========================================
    window.toggleSidebar = (show) => {
        const backdrop = document.getElementById('sidebar-backdrop');
        const panel = document.getElementById('sidebar-panel');
        if (show) {
            backdrop.classList.remove('hidden');
            void backdrop.offsetWidth;
            backdrop.classList.remove('opacity-0');
            panel.classList.remove('-translate-x-full');
        } else {
            panel.classList.add('-translate-x-full');
            backdrop.classList.add('opacity-0');
            setTimeout(() => backdrop.classList.add('hidden'), 300);
        }
    };

    // ==========================================
    // ADMIN PAGE
    // ==========================================
    function renderAdmin(app) {
      // LOGIN
      if (!state.isAuthenticated) {
        app.innerHTML = `
          <div class="h-screen bg-white dark:bg-black flex items-center justify-center p-4">
            <div class="w-full max-w-md animate-fade-in text-center">
                <div class="inline-flex p-4 rounded-full bg-red-100 dark:bg-red-900/20 mb-6 text-red-600 dark:text-red-500">${createIcon('lock', 32)}</div>
                <h1 class="text-3xl font-bold mb-2 dark:text-white">Admin Access</h1>
                <p class="text-gray-500 mb-8">Enter security PIN</p>
                <input id="pin-input" type="password" inputmode="numeric" class="w-full bg-gray-50 dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 p-4 rounded-xl text-center text-2xl tracking-[0.5em] focus:outline-none focus:ring-2 focus:ring-blue-500 dark:text-white mb-6" placeholder="••••" autofocus>
                <div class="flex justify-center gap-4">
                    <button onclick="window.location.hash='/'" class="text-gray-400 hover:text-gray-600 text-sm">Cancel</button>
                    <button onclick="Theme.toggle()" class="p-2 rounded-full bg-gray-100 dark:bg-zinc-900 dark:text-yellow-400">${createIcon(document.documentElement.classList.contains('dark')?'sun':'moon')}</button>
                </div>
            </div>
          </div>
        `;
        document.getElementById('pin-input').oninput = (e) => {
            if (e.target.value === ADMIN_PASS) {
                state.isAuthenticated = true;
                render();
            }
        };
        return;
      }

      // DASHBOARD
      app.innerHTML = `
        <div class="flex flex-col md:flex-row h-screen bg-gray-50 dark:bg-black text-gray-900 dark:text-white overflow-hidden">
            
            <!-- Sidebar -->
            <div class="w-full md:w-80 bg-white dark:bg-zinc-950 border-r border-gray-200 dark:border-zinc-800 flex flex-col z-20 shadow-lg md:shadow-none h-1/3 md:h-full">
                <div class="p-6 border-b border-gray-100 dark:border-zinc-800 flex justify-between items-center sticky top-0 bg-white dark:bg-zinc-950 z-10">
                    <div>
                        <h1 class="text-xl font-black text-blue-600">ADMIN</h1>
                        <p class="text-[10px] text-green-500 font-bold tracking-wider">● ONLINE</p>
                    </div>
                    <button onclick="Theme.toggle()" class="p-2 rounded-full bg-gray-100 dark:bg-zinc-800 dark:text-yellow-400">${createIcon(document.documentElement.classList.contains('dark')?'sun':'moon')}</button>
                </div>
                
                <div class="flex-1 overflow-y-auto custom-scroll p-6 space-y-4">
                    <!-- Stats -->
                    <div class="bg-blue-50 dark:bg-zinc-900 p-4 rounded-xl border border-blue-100 dark:border-zinc-800">
                        <div class="flex justify-between items-center mb-2 text-blue-600 dark:text-blue-400">
                            <div class="flex gap-2 items-center"><span class="text-xs font-bold uppercase">Contributions</span></div>
                            <button onclick="if(confirm('Reset Counter to 0?')) DB.resetStats()" class="hover:text-red-500 transition-colors">${createIcon('refresh-ccw', 14)}</button>
                        </div>
                        <div class="stat-counter text-3xl font-mono font-bold dark:text-white">${state.stats.totalContributions}</div>
                    </div>
                    
                    <!-- Settings -->
                    <div class="bg-purple-50 dark:bg-zinc-900 p-4 rounded-xl border border-purple-100 dark:border-zinc-800">
                        <div class="flex gap-2 items-center mb-2 text-purple-600 dark:text-purple-400"><span class="text-xs font-bold uppercase">Interval (Sec)</span></div>
                        <input id="input-interval" type="number" value="${state.settings.intervalSeconds}" onchange="if(this.value>0) DB.updateSettings({intervalSeconds: parseInt(this.value)})" class="w-full bg-white dark:bg-black p-2 rounded border border-gray-200 dark:border-zinc-700 font-mono focus:outline-none focus:border-purple-500">
                    </div>
                </div>

                <div class="p-4 border-t border-gray-100 dark:border-zinc-800">
                    <button onclick="state.isAuthenticated=false; render()" class="flex items-center gap-2 text-sm text-red-500 font-bold hover:bg-red-50 dark:hover:bg-red-900/20 p-2 rounded-lg w-full transition-colors">${createIcon('log-out', 16)} Logout</button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="flex-1 flex flex-col h-2/3 md:h-full bg-gray-50 dark:bg-black overflow-hidden relative">
                <div class="p-6 md:p-10 flex-1 overflow-y-auto custom-scroll">
                    <!-- Header (Fixed Add Button) -->
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-2xl font-bold">QR Management</h2>
                        <button onclick="document.getElementById('file-upload').click()" class="bg-gray-900 dark:bg-white text-white dark:text-black px-5 py-2.5 rounded-xl text-sm font-bold shadow-sm hover:scale-105 transition-transform flex items-center gap-2">
                            ${createIcon('plus', 18)} Add QR
                        </button>
                        <input type="file" id="file-upload" class="hidden" accept="image/*" onchange="handleFile(this)">
                    </div>

                    ${state.qrs.length === 0 ? `
                        <div class="flex flex-col items-center justify-center h-40 text-gray-400 border-2 border-dashed border-gray-200 dark:border-zinc-800 rounded-2xl">
                            ${createIcon('cloud', 32)}
                            <p class="mt-2 text-sm">Cloud Storage Empty</p>
                        </div>
                    ` : `
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 pb-20">
                            ${state.qrs.map((qr, i) => `
                                <div class="bg-white dark:bg-zinc-900 p-3 rounded-2xl border border-gray-100 dark:border-zinc-800 group hover:border-gray-300 dark:hover:border-zinc-600 transition-all shadow-sm hover:shadow-md">
                                    <div class="aspect-square bg-gray-50 dark:bg-black rounded-xl p-4 flex items-center justify-center relative border border-gray-100 dark:border-zinc-800 mb-3">
                                        <img src="${qr.base64}" class="w-full h-full object-contain">
                                        <span class="absolute top-2 left-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded backdrop-blur">#${i+1}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div class="flex gap-1 bg-gray-50 dark:bg-black rounded-lg p-1">
                                            <button onclick="moveQR(${i}, -1)" class="p-1.5 hover:bg-white dark:hover:bg-zinc-800 rounded text-gray-500 disabled:opacity-30" ${i===0?'disabled':''}>${createIcon('arrow-up', 14)}</button>
                                            <button onclick="moveQR(${i}, 1)" class="p-1.5 hover:bg-white dark:hover:bg-zinc-800 rounded text-gray-500 disabled:opacity-30" ${i===state.qrs.length-1?'disabled':''}>${createIcon('arrow-down', 14)}</button>
                                        </div>
                                        <button onclick="if(confirm('Delete QR?')) DB.deleteQR('${qr.id}')" class="text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 p-2 rounded-lg transition-colors">${createIcon('trash-2', 16)}</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
            </div>
        </div>
      `;
    }

    // ==========================================
    // GLOBAL ACTIONS (for onclicks)
    // ==========================================
    window.handleFile = (input) => {
        if(input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                DB.addQR({ id: Date.now().toString(), name: 'QR', base64: e.target.result });
            };
            reader.readAsDataURL(input.files[0]);
        }
    };

    window.moveQR = (index, direction) => {
        if ((index === 0 && direction === -1) || (index === state.qrs.length - 1 && direction === 1)) return;
        const newQRs = [...state.qrs];
        const target = index + direction;
        [newQrs[index], newQrs[target]] = [newQrs[target], newQrs[index]];
        DB.reorderQRs(newQRs);
    };

    // Initialize
    Theme.init();
    DB.init();
    window.addEventListener('hashchange', handleRoute);
    window.addEventListener('load', handleRoute);

  </script>
</body>
</html>
