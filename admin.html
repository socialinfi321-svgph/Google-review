<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Review Partner</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Tailwind Configuration -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          animation: {
            'blob': 'blob 7s infinite',
            'fade-in': 'fadeIn 0.5s ease-out forwards',
            'slide-in': 'slideIn 0.3s ease-out forwards',
          },
          keyframes: {
            blob: {
              '0%': { transform: 'translate(0px, 0px) scale(1)' },
              '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
              '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
              '100%': { transform: 'translate(0px, 0px) scale(1)' },
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideIn: {
              '0%': { transform: 'translateX(-100%)' },
              '100%': { transform: 'translateX(0)' },
            }
          }
        }
      }
    }
  </script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
    }
    /* Hide scrollbar */
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    /* Transitions for dark mode */
    .transition-colors-custom {
      transition: background-color 0.5s ease, color 0.5s ease;
    }

    /* Base64 Image container helper */
    .qr-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "lucide-react": "https://esm.sh/lucide-react@^0.561.0",
    "framer-motion": "https://esm.sh/framer-motion@^12.23.26",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.10.1"
  }
}
</script>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-zinc-950 dark:text-gray-100 transition-colors-custom">
  
  <!-- App Root -->
  <div id="app" class="min-h-screen w-full relative overflow-hidden"></div>

  <!-- Application Logic -->
  <script type="module">
    // ==========================================
    // CONSTANTS & TYPES
    // ==========================================
    const STORAGE_KEYS = {
      QRS: 'review_partner_qrs',
      SETTINGS: 'review_partner_settings',
      STATS: 'review_partner_stats',
      THEME: 'review_partner_theme',
    };

    const ADMIN_PASS = "12345676";
    
    const DEFAULT_SETTINGS = { intervalSeconds: 10 };
    const DEFAULT_STATS = { totalContributions: 0, lastResetTime: Date.now() };

    // ==========================================
    // STATE MANAGEMENT (Global)
    // ==========================================
    let state = {
      qrs: [],
      settings: DEFAULT_SETTINGS,
      stats: DEFAULT_STATS,
      isAuthenticated: false,
      currentQRIndex: 0,
      isSidebarOpen: false,
      rotationIntervalId: null,
      statsIntervalId: null,
      passwordInput: ""
    };

    // ==========================================
    // SERVICES (Storage)
    // ==========================================
    const StorageService = {
      loadAll: () => {
        // Load QRs
        try {
          const qrs = localStorage.getItem(STORAGE_KEYS.QRS);
          state.qrs = qrs ? JSON.parse(qrs) : [];
        } catch(e) { state.qrs = []; }

        // Load Settings
        try {
          const sett = localStorage.getItem(STORAGE_KEYS.SETTINGS);
          state.settings = sett ? JSON.parse(sett) : DEFAULT_SETTINGS;
        } catch(e) { state.settings = DEFAULT_SETTINGS; }

        // Load Stats & Check Reset Logic
        StorageService.getStats();
      },

      getStats: () => {
        try {
          const data = localStorage.getItem(STORAGE_KEYS.STATS);
          let stats = data ? JSON.parse(data) : DEFAULT_STATS;
          
          // 24h Reset Logic
          const now = Date.now();
          if (now - stats.lastResetTime > 86400000) { // 24 hours in ms
            stats = { totalContributions: 0, lastResetTime: now };
            localStorage.setItem(STORAGE_KEYS.STATS, JSON.stringify(stats));
          }
          state.stats = stats;
          return stats;
        } catch(e) {
          state.stats = DEFAULT_STATS;
          return DEFAULT_STATS;
        }
      },

      saveQRs: (newQRs) => {
        state.qrs = newQRs;
        localStorage.setItem(STORAGE_KEYS.QRS, JSON.stringify(newQRs));
        render(); // Re-render to show changes
      },

      saveSettings: (newSettings) => {
        state.settings = newSettings;
        localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(newSettings));
      },

      incrementStats: () => {
        const stats = StorageService.getStats();
        const newStats = { ...stats, totalContributions: stats.totalContributions + 1 };
        localStorage.setItem(STORAGE_KEYS.STATS, JSON.stringify(newStats));
        state.stats = newStats;
        // Update DOM directly for smoother animation
        const counterEl = document.getElementById('counter-display');
        if(counterEl) counterEl.textContent = newStats.totalContributions;
      },

      manualResetStats: () => {
        const newStats = { totalContributions: 0, lastResetTime: Date.now() };
        localStorage.setItem(STORAGE_KEYS.STATS, JSON.stringify(newStats));
        state.stats = newStats;
        render();
      },

      exportData: () => {
        const data = {
          qrs: state.qrs,
          settings: state.settings,
          stats: state.stats,
          timestamp: Date.now(),
        };
        const jsonString = JSON.stringify(data);
        const blob = new Blob([jsonString], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `review-partner-data-${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    };

    // ==========================================
    // THEME LOGIC
    // ==========================================
    const ThemeService = {
      init: () => {
        const storedTheme = localStorage.getItem(STORAGE_KEYS.THEME);
        if (storedTheme === 'dark' || (!storedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      },
      toggle: () => {
        if (document.documentElement.classList.contains('dark')) {
          document.documentElement.classList.remove('dark');
          localStorage.setItem(STORAGE_KEYS.THEME, 'light');
        } else {
          document.documentElement.classList.add('dark');
          localStorage.setItem(STORAGE_KEYS.THEME, 'dark');
        }
        // Re-render icons slightly later to ensure correct SVG if needed, though Lucide uses currentColor
      }
    };

    // ==========================================
    // ROUTER
    // ==========================================
    const Router = {
      routes: {
        '/': renderDisplayPage,
        '/admin': renderAdminPage
      },
      init: () => {
        window.addEventListener('hashchange', Router.handleRoute);
        Router.handleRoute();
      },
      handleRoute: () => {
        // Clear intervals when switching pages
        if(state.rotationIntervalId) clearInterval(state.rotationIntervalId);
        if(state.statsIntervalId) clearInterval(state.statsIntervalId);
        state.isSidebarOpen = false; // Reset sidebar
        
        const hash = window.location.hash.slice(1) || '/';
        const renderer = Router.routes[hash] || Router.routes['/'];
        
        // Refresh data
        StorageService.loadAll();
        renderer();
      }
    };

    // ==========================================
    // RENDER HELPERS
    // ==========================================
    function render() {
      // Re-trigger current route render
      Router.handleRoute(); 
    }

    function createIcon(name, size = 24, className = "") {
      // Lucide replaces these based on data-lucide attribute
      return `<i data-lucide="${name}" width="${size}" height="${size}" class="${className}"></i>`;
    }

    // ==========================================
    // DISPLAY PAGE
    // ==========================================
    function renderDisplayPage() {
      const app = document.getElementById('app');
      
      // Start Rotation Timer
      if (state.qrs.length > 1) {
        state.rotationIntervalId = setInterval(() => {
          state.currentQRIndex = (state.currentQRIndex + 1) % state.qrs.length;
          const imgEl = document.getElementById('qr-image');
          if(imgEl) {
            // Simple fade effect
            imgEl.style.opacity = '0';
            setTimeout(() => {
              if(state.qrs[state.currentQRIndex]) {
                imgEl.src = state.qrs[state.currentQRIndex].base64;
                imgEl.style.opacity = '1';
              }
            }, 200);
          }
        }, state.settings.intervalSeconds * 1000);
      }
      
      // Check for stats update (24h reset) periodically
      state.statsIntervalId = setInterval(() => {
        StorageService.getStats();
        const counterEl = document.getElementById('counter-display');
        if(counterEl) counterEl.textContent = state.stats.totalContributions;
      }, 60000);

      const currentQR = state.qrs[state.currentQRIndex];

      app.innerHTML = `
        <!-- Blobs -->
        <div class="absolute top-0 -left-10 w-96 h-96 bg-purple-300 dark:bg-purple-900/20 rounded-full mix-blend-multiply dark:mix-blend-normal filter blur-3xl opacity-50 animate-blob"></div>
        <div class="absolute top-0 -right-10 w-96 h-96 bg-blue-300 dark:bg-blue-900/20 rounded-full mix-blend-multiply dark:mix-blend-normal filter blur-3xl opacity-50 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-20 left-1/2 w-96 h-96 bg-pink-300 dark:bg-pink-900/20 rounded-full mix-blend-multiply dark:mix-blend-normal filter blur-3xl opacity-50 animate-blob animation-delay-4000"></div>

        <!-- Sidebar (Hidden by default) -->
        <div id="sidebar-backdrop" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-40 hidden transition-opacity duration-300 opacity-0"></div>
        <div id="sidebar-panel" class="fixed top-0 left-0 h-full w-80 bg-white dark:bg-zinc-900 border-r border-gray-200 dark:border-zinc-800 z-50 shadow-2xl p-6 flex flex-col transform -translate-x-full transition-transform duration-300">
            <div class="flex justify-between items-center mb-8">
              <h2 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-purple-600">Menu</h2>
              <button id="close-sidebar" class="p-2 hover:bg-gray-100 dark:hover:bg-zinc-800 rounded-full transition-colors text-gray-500 dark:text-gray-400">
                ${createIcon('x')}
              </button>
            </div>
            <div class="flex-1 overflow-y-auto">
              <div class="bg-gray-50 dark:bg-zinc-800/50 p-5 rounded-2xl border border-gray-100 dark:border-zinc-700 mb-6">
                <div class="flex gap-3 mb-2">
                  <div class="text-blue-600 dark:text-blue-400">${createIcon('info', 20)}</div>
                  <h3 class="font-bold text-gray-900 dark:text-white text-sm uppercase tracking-wider">Disclaimer</h3>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed text-justify">
                  All reviews submitted through this application are voluntary. You are not forced, coerced, or incentivized to provide positive feedback. Your honest opinion helps us improve our services.
                </p>
              </div>
            </div>
            <div class="mt-auto pt-6 border-t border-gray-100 dark:border-zinc-800">
              <p class="text-xs text-center text-gray-400">Review Partner System v2.1</p>
            </div>
        </div>

        <!-- Top Controls -->
        <div class="absolute top-6 left-6 z-30">
          <button id="open-sidebar" class="p-3 bg-white/50 dark:bg-zinc-800/50 backdrop-blur-md rounded-full shadow-lg text-gray-900 dark:text-white hover:scale-110 transition-transform">
            ${createIcon('menu')}
          </button>
        </div>
        <div class="absolute top-6 right-6 z-30">
          <button id="theme-toggle-display" class="p-3 rounded-full bg-white/50 dark:bg-zinc-800/50 backdrop-blur-md shadow-lg hover:scale-110 transition-transform text-gray-600 dark:text-yellow-400">
            ${createIcon(document.documentElement.classList.contains('dark') ? 'sun' : 'moon')}
          </button>
        </div>

        <!-- Content -->
        <div class="flex flex-col items-center justify-center h-full w-full px-6 z-10 relative">
          <!-- Title -->
          <div class="text-center mb-8 md:mb-12 animate-fade-in">
             <h1 class="text-4xl md:text-6xl font-black tracking-tighter leading-tight mb-2">
               <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 dark:from-blue-400 dark:via-indigo-400 dark:to-purple-400">Review</span>
               <span class="text-gray-900 dark:text-white"> Partner</span>
             </h1>
             <p class="text-xs md:text-sm font-bold tracking-[0.2em] text-gray-400 uppercase">Contribution System</p>
          </div>

          <!-- QR Card -->
          <div class="relative mb-10 md:mb-14 animate-fade-in" style="animation-delay: 0.2s">
              <div class="absolute -inset-0.5 bg-gradient-to-tr from-blue-500 to-purple-500 rounded-[2.5rem] opacity-30 blur-lg"></div>
              <div class="relative w-[280px] h-[280px] md:w-[360px] md:h-[360px] bg-white dark:bg-zinc-900 rounded-[2rem] shadow-2xl flex items-center justify-center p-6 border border-gray-100 dark:border-zinc-800">
                  ${currentQR 
                    ? `<img id="qr-image" src="${currentQR.base64}" alt="QR Code" class="w-full h-full object-contain transition-opacity duration-300" />` 
                    : `<div class="text-center"><p class="text-gray-400 text-lg font-medium">No QR Code</p><p class="text-xs text-gray-500 mt-2">Add via Admin</p></div>`
                  }
              </div>
          </div>

          <!-- Contribute Button -->
          <button id="btn-contribute" class="group relative flex items-center gap-3 bg-gray-900 dark:bg-white text-white dark:text-black px-12 py-4 rounded-2xl font-bold text-lg shadow-xl hover:scale-105 active:scale-95 transition-all animate-fade-in" style="animation-delay: 0.4s">
            <div class="absolute inset-0 rounded-2xl bg-white/20 dark:bg-black/10 blur opacity-0 group-hover:opacity-100 transition-opacity"></div>
            ${createIcon('plus', 20, "stroke-[3px]")}
            <span>Contribute</span>
          </button>
        </div>

        <!-- Floating Counter -->
        <div class="absolute bottom-6 right-6 md:bottom-10 md:right-10 flex flex-col items-end z-20 pointer-events-none select-none animate-fade-in" style="animation-delay: 0.6s">
           <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-0">Total</span>
           <div id="counter-display" class="text-6xl md:text-7xl font-mono font-black text-gray-900 dark:text-white leading-none tracking-tighter">
             ${state.stats.totalContributions}
           </div>
        </div>
      `;

      // Init Icons
      lucide.createIcons();

      // Events
      document.getElementById('btn-contribute').onclick = () => {
        StorageService.incrementStats();
      };

      document.getElementById('theme-toggle-display').onclick = () => {
        ThemeService.toggle();
        // Re-render icon
        Router.handleRoute(); 
      };

      // Sidebar Logic
      const sidebarPanel = document.getElementById('sidebar-panel');
      const sidebarBackdrop = document.getElementById('sidebar-backdrop');
      
      const openSidebar = () => {
        sidebarBackdrop.classList.remove('hidden');
        // Force reflow
        void sidebarBackdrop.offsetWidth; 
        sidebarBackdrop.classList.remove('opacity-0');
        sidebarPanel.classList.remove('-translate-x-full');
      };

      const closeSidebar = () => {
        sidebarPanel.classList.add('-translate-x-full');
        sidebarBackdrop.classList.add('opacity-0');
        setTimeout(() => {
          sidebarBackdrop.classList.add('hidden');
        }, 300);
      };

      document.getElementById('open-sidebar').onclick = openSidebar;
      document.getElementById('close-sidebar').onclick = closeSidebar;
      document.getElementById('sidebar-backdrop').onclick = closeSidebar;
    }

    // ==========================================
    // ADMIN PAGE
    // ==========================================
    function renderAdminPage() {
      const app = document.getElementById('app');
      
      // LOGIN VIEW
      if (!state.isAuthenticated) {
        app.innerHTML = `
          <div class="min-h-screen bg-white dark:bg-black flex items-center justify-center p-4 transition-colors duration-300">
            <div class="w-full max-w-md animate-fade-in">
                <div class="text-center mb-10">
                    <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-red-100 dark:bg-red-900/20 mb-6 text-red-600 dark:text-red-500">
                        ${createIcon('lock', 32)}
                    </div>
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Restricted Access</h1>
                    <p class="text-gray-500 dark:text-gray-400">Please enter the security PIN.</p>
                </div>
                <div class="bg-gray-50 dark:bg-zinc-900 p-8 rounded-2xl border border-gray-200 dark:border-zinc-800 shadow-xl">
                   <label class="block text-xs font-bold uppercase text-gray-400 mb-2">Security PIN</label>
                   <input
                     id="admin-password"
                     type="password" 
                     inputmode="numeric"
                     class="w-full bg-white dark:bg-black border border-gray-200 dark:border-zinc-700 text-gray-900 dark:text-white text-center text-2xl tracking-[0.5em] font-mono py-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                     placeholder="••••••••"
                     autofocus
                     value="${state.passwordInput}"
                   />
                </div>
                <div class="mt-8 flex justify-center">
                  <button id="theme-toggle-login" class="p-3 rounded-full bg-gray-100 dark:bg-zinc-800 text-gray-600 dark:text-yellow-400 hover:scale-110 transition-all shadow-sm">
                    ${createIcon(document.documentElement.classList.contains('dark') ? 'sun' : 'moon')}
                  </button>
                </div>
            </div>
          </div>
        `;
        lucide.createIcons();
        
        const input = document.getElementById('admin-password');
        input.focus();
        input.oninput = (e) => {
          state.passwordInput = e.target.value;
          if (e.target.value === ADMIN_PASS) {
            state.isAuthenticated = true;
            state.passwordInput = "";
            render();
          }
        };
        document.getElementById('theme-toggle-login').onclick = () => {
          ThemeService.toggle();
          render();
        };
        return;
      }

      // DASHBOARD VIEW
      app.innerHTML = `
        <div class="min-h-screen bg-gray-50 dark:bg-black text-gray-900 dark:text-white flex flex-col md:flex-row font-sans transition-colors duration-300">
          
          <!-- Sidebar / Controls -->
          <div class="w-full md:w-80 bg-white dark:bg-zinc-950 border-r border-gray-200 dark:border-zinc-800 flex flex-col p-6 fixed md:relative z-20 h-auto md:h-screen shadow-lg md:shadow-none overflow-y-auto">
            <div class="mb-8 flex justify-between items-start">
              <div>
                <h1 class="text-2xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-br from-blue-600 to-purple-600">ADMIN</h1>
                <p class="text-xs text-gray-400 font-mono mt-1">V2.1 CONTROL CENTER</p>
              </div>
              <button id="theme-toggle-admin" class="p-2 rounded-full bg-gray-100 dark:bg-zinc-800 text-gray-600 dark:text-yellow-400">
                ${createIcon(document.documentElement.classList.contains('dark') ? 'sun' : 'moon')}
              </button>
            </div>

            <div class="space-y-6">
              <!-- Stats -->
              <div class="bg-blue-50 dark:bg-zinc-900 p-5 rounded-2xl border border-blue-100 dark:border-zinc-800">
                <div class="flex justify-between items-start mb-2">
                    <div class="flex items-center gap-3 text-blue-600 dark:text-blue-400">
                        ${createIcon('activity', 18)}
                        <span class="text-xs font-bold uppercase tracking-wider">Contributions</span>
                    </div>
                    <button id="btn-reset-counter" class="text-red-500 hover:text-red-700 dark:text-red-400" title="Reset Counter">
                        ${createIcon('refresh-ccw', 16)}
                    </button>
                </div>
                <div class="text-4xl font-mono font-bold text-gray-900 dark:text-white">
                  ${state.stats.totalContributions}
                </div>
                <p class="text-[10px] text-gray-400 mt-2">Auto-resets every 24h</p>
              </div>

              <!-- Export -->
              <div class="bg-green-50 dark:bg-zinc-900 p-5 rounded-2xl border border-green-100 dark:border-zinc-800">
                <div class="flex items-center gap-3 text-green-600 dark:text-green-400 mb-4">
                    ${createIcon('save', 18)}
                    <span class="text-xs font-bold uppercase tracking-wider">Mobile Sync</span>
                </div>
                <p class="text-xs text-gray-600 dark:text-gray-400 mb-4 leading-relaxed">
                    To see QRs on phone: Export here, send file to phone, import via Menu.
                </p>
                <button id="btn-export" class="w-full flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg text-sm font-bold transition-colors">
                    ${createIcon('download', 16)} Export Data
                </button>
              </div>

              <!-- Settings -->
              <div class="bg-purple-50 dark:bg-zinc-900 p-5 rounded-2xl border border-purple-100 dark:border-zinc-800">
                <div class="flex items-center gap-3 text-purple-600 dark:text-purple-400 mb-2">
                  ${createIcon('clock', 18)}
                  <span class="text-xs font-bold uppercase tracking-wider">Interval (Sec)</span>
                </div>
                <input id="input-interval" type="number" value="${state.settings.intervalSeconds}" class="w-full bg-white dark:bg-black border border-gray-200 dark:border-zinc-700 text-gray-900 dark:text-white p-2 rounded-lg font-mono focus:outline-none focus:border-purple-500" />
              </div>
            </div>

            <div class="mt-auto pt-6">
                <button id="btn-logout" class="flex items-center gap-2 text-gray-500 hover:text-red-500 transition-colors text-sm font-medium">
                    ${createIcon('log-out', 16)} Logout
                </button>
            </div>
          </div>

          <!-- Main Content -->
          <div class="flex-1 p-6 md:p-10 overflow-y-auto">
            <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-10 gap-4">
              <h2 class="text-3xl font-bold">QR Management</h2>
              <div class="flex gap-2">
                 <button id="btn-add-qr" class="flex items-center gap-2 bg-gray-900 dark:bg-white hover:bg-gray-800 dark:hover:bg-gray-200 text-white dark:text-black px-6 py-3 rounded-full font-bold transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                   ${createIcon('plus', 20)} <span>Add QR</span>
                 </button>
                 <input type="file" id="file-upload" class="hidden" accept="image/*" />
              </div>
            </header>

            ${state.qrs.length === 0 ? `
              <div class="border-2 border-dashed border-gray-200 dark:border-zinc-800 rounded-3xl p-20 text-center animate-fade-in">
                <div class="w-16 h-16 bg-gray-100 dark:bg-zinc-900 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400">
                    ${createIcon('upload', 32)}
                </div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">No QR Codes Yet</h3>
                <p class="text-gray-500">Upload an image to get started.</p>
              </div>
            ` : `
              <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6 animate-fade-in">
                ${state.qrs.map((qr, index) => `
                  <div class="bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-3xl p-4 flex flex-col gap-4 group hover:shadow-2xl transition-all duration-300">
                    <div class="relative aspect-square bg-gray-50 dark:bg-black rounded-2xl flex items-center justify-center overflow-hidden p-6 border border-gray-100 dark:border-zinc-800">
                      <img src="${qr.base64}" alt="QR" class="w-full h-full object-contain" />
                      <div class="absolute top-3 left-3 bg-black/80 backdrop-blur text-white text-[10px] font-bold px-3 py-1 rounded-full">SEQ: ${index + 1}</div>
                    </div>
                    <div class="flex items-center justify-between mt-auto px-1">
                      <div class="flex items-center gap-1 bg-gray-100 dark:bg-black rounded-xl p-1">
                        <button class="btn-move-up p-2 hover:bg-white dark:hover:bg-zinc-800 rounded-lg text-gray-400 hover:text-gray-900 dark:hover:text-white disabled:opacity-30 transition-all shadow-sm" data-index="${index}" ${index === 0 ? 'disabled' : ''}>${createIcon('arrow-up', 18)}</button>
                        <button class="btn-move-down p-2 hover:bg-white dark:hover:bg-zinc-800 rounded-lg text-gray-400 hover:text-gray-900 dark:hover:text-white disabled:opacity-30 transition-all shadow-sm" data-index="${index}" ${index === state.qrs.length - 1 ? 'disabled' : ''}>${createIcon('arrow-down', 18)}</button>
                      </div>
                      <button class="btn-delete flex items-center gap-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 px-4 py-2 rounded-xl transition-colors text-sm font-bold" data-id="${qr.id}">
                        ${createIcon('trash-2', 18)} <span>Remove</span>
                      </button>
                    </div>
                  </div>
                `).join('')}
              </div>
            `}
          </div>
        </div>
      `;

      lucide.createIcons();

      // Events
      document.getElementById('theme-toggle-admin').onclick = () => { ThemeService.toggle(); render(); };
      document.getElementById('btn-logout').onclick = () => { state.isAuthenticated = false; render(); };
      document.getElementById('btn-reset-counter').onclick = () => {
        if(confirm("Reset contribution counter to 0?")) StorageService.manualResetStats();
      };
      document.getElementById('btn-export').onclick = StorageService.exportData;
      
      document.getElementById('input-interval').onchange = (e) => {
        const val = parseInt(e.target.value);
        if(val > 0) StorageService.saveSettings({ intervalSeconds: val });
      };

      const fileInput = document.getElementById('file-upload');
      document.getElementById('btn-add-qr').onclick = () => fileInput.click();
      fileInput.onchange = (e) => {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (evt) => {
          const newQR = { id: Date.now().toString(), name: 'QR', base64: evt.target.result };
          StorageService.saveQRs([...state.qrs, newQR]);
        };
        reader.readAsDataURL(file);
      };

      // Delegated events for list items
      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.onclick = (e) => {
          const id = e.currentTarget.dataset.id;
          if(confirm("Delete this QR?")) StorageService.saveQRs(state.qrs.filter(q => q.id !== id));
        };
      });

      document.querySelectorAll('.btn-move-up').forEach(btn => {
        btn.onclick = (e) => {
          const index = parseInt(e.currentTarget.dataset.index);
          if(index > 0) {
            const newQrs = [...state.qrs];
            [newQrs[index], newQrs[index-1]] = [newQrs[index-1], newQrs[index]];
            StorageService.saveQRs(newQrs);
          }
        };
      });

      document.querySelectorAll('.btn-move-down').forEach(btn => {
        btn.onclick = (e) => {
          const index = parseInt(e.currentTarget.dataset.index);
          if(index < state.qrs.length - 1) {
            const newQrs = [...state.qrs];
            [newQrs[index], newQrs[index+1]] = [newQrs[index+1], newQrs[index]];
            StorageService.saveQRs(newQrs);
          }
        };
      });
    }

    // ==========================================
    // INITIALIZATION
    // ==========================================
    (function init() {
      ThemeService.init();
      StorageService.loadAll();
      Router.init();
    })();

  </script>
</body>
</html>
